# å…¨å±€æƒé™æ£€æŸ¥ä½¿ç”¨æŒ‡å—

## ğŸ“š æ¦‚è¿°

æˆ‘ä»¬æä¾›äº†å¤šç§æ–¹å¼æ¥åœ¨uniappé¡¹ç›®ä¸­è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œæ”¯æŒå„ç§ä½¿ç”¨åœºæ™¯ã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šç»„åˆå¼å‡½æ•° (æ¨è)

åœ¨ `<script setup>` ä¸­ä½¿ç”¨ï¼š

```vue
<template>
  <view>
    <!-- å•ä¸ªæƒé™æ£€æŸ¥ -->
    <wd-button v-if="hasAuth('userAdd')" type="primary">æ·»åŠ ç”¨æˆ·</wd-button>
    
    <!-- å¤šä¸ªæƒé™æ£€æŸ¥(ä»»æ„ä¸€ä¸ªå³å¯) -->
    <wd-button v-if="hasAuth(['userEdit', 'userDelete'])" type="success">ç¼–è¾‘ç”¨æˆ·</wd-button>
    
    <!-- å¤šä¸ªæƒé™æ£€æŸ¥(å¿…é¡»å…¨éƒ¨æ‹¥æœ‰) -->
    <wd-button v-if="hasAuth(['userView', 'userManage'], 'every')" type="warning">ç®¡ç†ç”¨æˆ·</wd-button>
  </view>
</template>

<script setup lang="ts">
import { useAuth } from '@/utils/auth'

const { hasAuth, hasAuthBatch } = useAuth()

// åœ¨æ–¹æ³•ä¸­ä½¿ç”¨
function handleClick() {
  if (hasAuth('somePermission')) {
    // æ‰§è¡Œæ“ä½œ
  }
}
</script>
```

### æ–¹æ³•2ï¼šç›´æ¥å¯¼å…¥å‡½æ•°

```vue
<template>
  <view>
    <wd-button v-if="hasAuth('userAdd')" type="primary">æ·»åŠ </wd-button>
  </view>
</template>

<script setup lang="ts">
import { hasAuth } from '@/utils/auth'

function someMethod() {
  if (hasAuth('permission')) {
    // æ‰§è¡Œæ“ä½œ
  }
}
</script>
```

### æ–¹æ³•3ï¼šæ‰¹é‡æƒé™æ£€æŸ¥

```vue
<template>
  <view>
    <wd-button v-if="permissions.canAdd">æ·»åŠ </wd-button>
    <wd-button v-if="permissions.canEdit">ç¼–è¾‘</wd-button>
    <wd-button v-if="permissions.canDelete">åˆ é™¤</wd-button>
  </view>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useAuth } from '@/utils/auth'

const { hasAuthBatch } = useAuth()

// ä¸€æ¬¡æ€§æ£€æŸ¥å¤šä¸ªæƒé™
const permissions = computed(() => hasAuthBatch({
  canAdd: 'userAdd',
  canEdit: 'userEdit',
  canDelete: ['userDelete', 'adminDelete'], // å¤šä¸ªæƒé™é€‰å…¶ä¸€
  canManage: ['userManage', 'systemManage'] // å¤šä¸ªæƒé™é€‰å…¶ä¸€
}))
</script>
```

### æ–¹æ³•4ï¼šå…¨å±€å±æ€§ (Options API)

```vue
<template>
  <view>
    <wd-button v-if="$hasAuth('userAdd')" type="primary">æ·»åŠ </wd-button>
  </view>
</template>

<script>
export default {
  methods: {
    handleClick() {
      if (this.$hasAuth('permission')) {
        // æ‰§è¡Œæ“ä½œ
      }
    }
  }
}
</script>
```

## ğŸ›  API å‚è€ƒ

### `hasAuth(permissions, mode?)`

æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šæƒé™

**å‚æ•°ï¼š**
- `permissions: string | string[]` - æƒé™ç ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„
- `mode?: 'some' | 'every'` - æ£€æŸ¥æ¨¡å¼ï¼Œé»˜è®¤ 'some'
  - `'some'`: æœ‰ä»»æ„ä¸€ä¸ªæƒé™å³å¯
  - `'every'`: å¿…é¡»æ‹¥æœ‰æ‰€æœ‰æƒé™

**è¿”å›å€¼ï¼š**
- `boolean` - æ˜¯å¦æœ‰æƒé™

**ç¤ºä¾‹ï¼š**
```typescript
hasAuth('userAdd')                           // æ£€æŸ¥å•ä¸ªæƒé™
hasAuth(['userAdd', 'userEdit'])            // æ£€æŸ¥å¤šä¸ªæƒé™(ä»»æ„ä¸€ä¸ª)
hasAuth(['userAdd', 'userEdit'], 'every')  // æ£€æŸ¥å¤šä¸ªæƒé™(å…¨éƒ¨éœ€è¦)
```

### `hasAuthBatch(permissionMap)`

æ‰¹é‡æ£€æŸ¥æƒé™

**å‚æ•°ï¼š**
- `permissionMap: Record<string, string | string[]>` - æƒé™æ˜ å°„å¯¹è±¡

**è¿”å›å€¼ï¼š**
- `Record<string, boolean>` - æƒé™æ£€æŸ¥ç»“æœå¯¹è±¡

**ç¤ºä¾‹ï¼š**
```typescript
const result = hasAuthBatch({
  canAdd: 'userAdd',
  canEdit: ['userEdit', 'adminEdit'],
  canDelete: 'userDelete'
})
// è¿”å›: { canAdd: true, canEdit: false, canDelete: true }
```

### `useAuth()`

ç»„åˆå¼å‡½æ•°ï¼Œè¿”å›æƒé™æ£€æŸ¥æ–¹æ³•

**è¿”å›å€¼ï¼š**
```typescript
{
  hasAuth: typeof hasAuth,
  hasAuthBatch: typeof hasAuthBatch,
  checkAuth: typeof hasAuth,      // hasAuthçš„åˆ«å
  checkAuthBatch: typeof hasAuthBatch  // hasAuthBatchçš„åˆ«å
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ¨èä½¿ç”¨ç»„åˆå¼å‡½æ•°**ï¼š`useAuth()` æä¾›äº†æœ€å¥½çš„ç±»å‹æ”¯æŒå’Œå¼€å‘ä½“éªŒ
2. **æ‰¹é‡æ£€æŸ¥æ€§èƒ½æ›´å¥½**ï¼šå¦‚æœéœ€è¦æ£€æŸ¥å¤šä¸ªæƒé™ï¼Œä½¿ç”¨ `hasAuthBatch`
3. **æƒé™ç ç»Ÿä¸€ç®¡ç†**ï¼šå»ºè®®å°†æƒé™ç å®šä¹‰ä¸ºå¸¸é‡ç»Ÿä¸€ç®¡ç†
4. **é”™è¯¯å¤„ç†**ï¼šæ²¡æœ‰æƒé™æ—¶ç»™ç”¨æˆ·å‹å¥½çš„æç¤º

## ğŸ” æƒé™ç ç®¡ç†

å»ºè®®åˆ›å»ºæƒé™ç å¸¸é‡æ–‡ä»¶ï¼š

```typescript
// constants/permissions.ts
export const PERMISSIONS = {
  USER: {
    ADD: 'userAdd',
    EDIT: 'userEdit',
    DELETE: 'userDelete',
    VIEW: 'userView'
  },
  SYSTEM: {
    CONFIG: 'systemConfig',
    LOG: 'systemLog'
  }
} as const

// ä½¿ç”¨
import { PERMISSIONS } from '@/constants/permissions'

hasAuth(PERMISSIONS.USER.ADD)
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. æƒé™æ£€æŸ¥åŸºäº `authStore.authButtonList`ï¼Œç¡®ä¿æƒé™æ•°æ®å·²æ­£ç¡®åŠ è½½
2. åœ¨å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œè‡ªå®šä¹‰æŒ‡ä»¤ `v-auth` ä¸å¯ç”¨ï¼Œè¯·ä½¿ç”¨ `v-if` é…åˆå‡½æ•°
3. æƒé™æ£€æŸ¥æ˜¯å‰ç«¯é™åˆ¶ï¼Œåç«¯ä»éœ€è¦è¿›è¡Œæƒé™éªŒè¯
4. å»ºè®®åœ¨è·¯ç”±çº§åˆ«ä¹Ÿè¿›è¡Œæƒé™æ§åˆ¶
